# Arxiv Analysis: Decoupling Task-Solving and Output Formatting in LLM Generation

**ID:** 2510.03595
**Date:** 2024-10-04
**Link:** https://arxiv.org/abs/2510.03595

## Executive Summary
The paper introduces "Deco-G," a decoding framework that improves Large Language Model (LLM) performance by explicitly decoupling task-solving from output formatting. The core idea is that LLMs perform better on reasoning tasks when they are not burdened with following strict formatting instructions simultaneously. Deco-G achieves this by using a separate, lightweight probabilistic model to handle format compliance, allowing the LLM to focus purely on the task. The research demonstrates a 1.0% to 6.0% relative performance gain on various tasks, validating the principle that separating these two concerns leads to more accurate and reliable results.

## Idea Brainstorming
*What concepts are potentially useful for THIS project?*
- **Concept 1: Pure, Task-Focused Prompts:** The most valuable concept is to feed our core reasoning agents (like `MarketAnalyst` and `Trader`) prompts that are entirely free of formatting instructions. This aligns perfectly with the planned `PromptBuilder` in the ARTEMIS architecture. The `PromptBuilder`'s primary role should be to isolate the core task for the agent.
- **Concept 2: A Dedicated "Formatter" Component:** Instead of implementing the paper's complex Hidden Markov Model (HMM), we can adopt the principle by creating a dedicated "Formatter Agent" or a "Formatting Toolkit." After a reasoning agent produces a raw, unstructured output, this component would be responsible for transforming that output into the required format (e.g., a specific JSON schema or a templated string). This provides a practical, Python-native solution.
- **Concept 3: Extend `AgentSpec` for Formatting Rules:** The existing `agentspec` framework, which is used for enforcing rules on agent behavior, could be extended to define the output formatting rules. This would create a unified, declarative system for managing both agent actions and their final output structure.

## Gap Analysis
*Compare paper concepts vs. `current_codebase`. What do we already have? What is missing?*

| Feature/Concept | Current State (Codebase) | Missing / Needed |
| :--- | :--- | :--- |
| **Decoupled Prompting** | Monolithic `instructions.md` files combine task logic and format rules. | **High:** The planned `PromptBuilder` from the ARTEMIS architecture is the key missing piece. This paper's findings provide strong justification for prioritizing its development. |
| **Dedicated Formatting** | Formatting is implicitly handled by each agent, leading to inconsistency and reduced performance. | **High:** A dedicated "Formatter Agent" or "Formatting Toolkit" is completely missing. This is a critical gap that the paper's research helps to identify. |
| **Formal Format Rules** | No formal system exists for defining output formats. They are just described in natural language within the prompt. | **Medium:** The `agentspec` framework exists but does not currently support format definitions. It needs to be extended to include this capability. |

## Implementation Plan
*Granular, step-by-step task list to port the ideas to our code.*

- [ ] **Task 1: Refine `PromptBuilder` Specification:** Update the ARTEMIS plan (`docs/01-plan.md`) to explicitly state that the `PromptBuilder` must strip all formatting instructions from prompts sent to reasoning agents.
- [ ] **Task 2: Design `FormattingToolkit`:** Create a new design document for a `FormattingToolkit`. This toolkit will have methods like `to_json(data: str, schema: dict)` and `apply_template(data: str, template: str)` and will be used by a new, dedicated "Formatter Agent."
- [ ] **Task 3: Extend `AgentSpec`:** Update the `agentspec` parser and enforcement engine to support a new `format` block, where output templates and JSON schemas can be defined.
- [ ] **Task 4: Create a "Formatter Agent":** Implement a new, lightweight agent whose sole responsibility is to receive unstructured output from another agent and apply a format to it using the `FormattingToolkit`.
- [ ] **Task 5: Update Orchestration Logic:** Modify the core agent interaction logic (e.g., in `backend/main.py`'s chat endpoint) to add the new formatting step to the workflow: `Triage -> PromptBuilder -> Reasoning Agent -> Formatter Agent -> Final Output`.
