# Arxiv Analysis: TaskGen: A Task-Based, Memory-Infused Agentic Framework using StrictJSON

**ID:** 2407.15734
**Date:** 2024-07-25
**Link:** https://arxiv.org/abs/2407.15734

## Executive Summary
The TaskGen paper introduces a robust framework for building multi-agent systems that emphasizes concise, structured communication and memory management. The core contributions are: 1) The use of `StrictJSON` to ensure reliable, token-efficient, and type-checked LLM outputs, moving away from verbose JSON schemas. 2) A formal two-step task decomposition process where an agent first reasons to select a tool/sub-agent and then generates its parameters. 3) The concepts of `Shared Memory` and `Global Context` to provide agents with explicit, need-to-know state information and dynamically updated system prompts. 4) A `Memory Bank` that stores knowledge across multiple levels of abstraction (e.g., raw data, summaries, strategies) to provide richer context via RAG. The framework's value proposition is a more reliable, cost-effective, and powerful agent architecture.

## Idea Brainstorming
- **StrictJSON for Tool Calls:** We can replace or augment the default `agno` function-calling mechanism with a `StrictJSON`-based approach. This would make prompts for tool selection more concise and the parsing of LLM outputs more robust, reducing runtime errors.
- **Structured Task Decomposition:** The `DeepTraderManager` can be re-architected to follow the paper's explicit two-step delegation model (select tool, then generate params). This would make its decision-making process more transparent and reliable.
- **Shared Memory & Global Context:** We can introduce an explicit, session-based shared state dictionary (`Shared Variables`) that all agents can access. This, combined with dynamically injecting key variables into agent prompts (`Global Context`), would ensure agents always have the most critical, up-to-date information (e.g., current market regime, portfolio risk level) without needing to make constant tool calls.
- **Multi-Level Memory Abstraction:** The `khala-agentmemory` package can be enhanced to support storing memories in distinct namespaces (e.g., `raw_price_data`, `market_summaries`, `successful_trades`). This would allow agents to query for more specific types of information, improving the relevance of retrieved context.

## Gap Analysis
| Feature/Concept | Current State (Codebase) | Missing / Needed |
| :--- | :--- | :--- |
| **Concise, Structured Output** | The `agno` framework is used for agent and tool management. Tool definitions and outputs likely rely on standard Python function calling with Pydantic, which tends to produce verbose JSON schemas in prompts. | A `StrictJSON`-like implementation is missing. The current approach is less token-efficient and potentially less robust against LLM formatting errors compared to the regex-based parsing described in the paper. |
| **Task Decomposition** | A hierarchical agent structure exists (`DeepTraderManager` leading specialized agents). The manager delegates tasks based on its instructions. | The formal two-step Chain-of-Thought process (1. Select function, 2. Generate params) is not explicitly implemented. The delegation is more of a general instruction-following workflow rather than a structured task breakdown. |
| **Shared Memory** | State is managed implicitly through a combination of `khala-agentmemory` and a SQLite database. Agents retrieve state by calling tools (`portfolio_toolkit`, `KhalaMemoryToolkit`). `agno` maintains a history of the conversation/tool calls. | An explicit, session-based `Shared Variables` dictionary that can be directly read from and written to by tools is absent. The current history mechanism is likely more verbose than the paper's concise `Subtasks Completed` format. |
| **Global Context** | Agents are initialized with static system prompts loaded from `instructions.md` files. There is no mechanism for dynamically altering these prompts based on real-time state. | The entire concept of a dynamic `global_context` that injects real-time state (e.g., current portfolio VaR) into an agent's prompt before execution is missing. |
| **Memory Bank (Multi-Abstraction)** | The `khala-agentmemory` package provides a strong foundation, functioning as a memory bank with vector search (RAG) capabilities. | The concept of storing memories across multiple, distinct levels of abstraction (e.g., raw data, summaries, strategies) is not explicitly implemented. The current memory is more of a general-purpose knowledge base. |

## Implementation Plan
- [ ] **Task 1: Implement a `StrictJSON`-like Tool Definition Utility.**
  - Create a new utility class/function that converts Python function signatures into a concise, token-efficient string format (Name, Description, Input, Output) as described in the paper, instead of using verbose JSON schemas.
  - Integrate this utility into the agent's function-calling mechanism to reduce prompt length and improve reliability.
- [ ] **Task 2: Refactor `DeepTraderManager` for Structured Task Decomposition.**
  - Update the `DeepTraderManager/instructions.md` to mandate a two-step thinking process: 1) First, reason about the overall task and select the appropriate sub-agent or tool. 2) Second, generate the specific inputs for that selected tool/agent.
  - This change will make the manager's delegation logic more explicit and aligned with the paper's structured approach.
- [ ] **Task 3: Introduce a `SharedMemoryManager` for Explicit State Handling.**
  - Develop a new class to manage a session-specific dictionary for shared variables (e.g., `current_portfolio_value`, `active_alerts`).
  - Create a `SharedMemoryToolkit` with `read_variable` and `write_variable` functions, and equip all agents with it. This will centralize state and make inter-agent communication more direct.
- [ ] **Task 4: Implement Dynamic Global Context for Agents.**
  - Modify the agent factory to accept a `global_context` template string.
  - Before each agent runs, this template will be populated with real-time data from the new `SharedMemoryManager`, injecting critical, up-to-date information directly into the agent's system prompt.
- [ ] **Task 5: Enhance `KhalaMemoryToolkit` for Multi-Level Abstraction.**
  - Propose a schema for storing memories in different "namespaces" or "levels" within the existing memory system (e.g., `raw_market_data`, `sentiment_summaries`, `tested_strategies`).
  - Add new tools to the `KhalaMemoryToolkit` for storing and retrieving information from these specific namespaces, allowing agents to access a richer and more organized set of memories.
