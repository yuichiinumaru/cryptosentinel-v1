Outra arquitetura alternativa envolve a utilização de serviços intermediários dedicados, construídos especificamente para lidar com as tarefas sensíveis de execução financeira. Nesse cenário, o agente financeiro, ao identificar uma oportunidade de negociação, por exemplo, enviaria uma instrução de alto nível (como "executar uma ordem de compra de X unidades do ativo Y") para um serviço de execução seguro. Esse serviço, executado em um ambiente altamente seguro e isolado, recuperaria as chaves de API necessárias de um gerenciador de segredos e realizaria a negociação propriamente dita.

Os benefícios dessa abordagem incluem um forte isolamento dos segredos, que são gerenciados e utilizados dentro de um serviço dedicado, e um controle granular sobre todas as ações financeiras sensíveis, que são executadas e registradas pelo serviço intermediário. No entanto, essa arquitetura geralmente implica em uma complexidade significativamente maior, pois requer o desenvolvimento e a manutenção de um serviço separado, e pode introduzir uma latência maior devido à comunicação entre o agente e o serviço intermediário.

A tabela a seguir resume as principais vantagens e desvantagens da integração direta com gerenciadores de segredos em comparação com a utilização de proxies seguros ou serviços intermediários dedicados:

**Tabela 1: Comparação de Arquiteturas de Acesso a Segredos**

| Característica | Integração Direta com Gerenciador de Segredos | Proxy Seguro | Serviço Intermediário Dedicado |
| :---- | :---- | :---- | :---- |
| Localização do Segredo | Ferramenta do Agente | Proxy Seguro | Serviço Intermediário Dedicado |
| Responsabilidade do Agente | Gerencia diretamente a recuperação de segredos | Envia requisições ao proxy | Envia instruções de alto nível |
| Complexidade Arquitetural | Menor | Média | Maior |
| Nível de Isolamento | Menor | Médio | Maior |
| Desempenho | Geralmente melhor | Potencial overhead devido ao salto de rede | Potencial overhead devido ao salto de rede e lógica do serviço |
| Controle | Descentralizado (dentro de cada agente) | Centralizado dentro do proxy | Centralizado dentro do serviço |

Essas arquiteturas alternativas oferecem maneiras eficazes de minimizar a exposição direta de segredos sensíveis às ferramentas de agentes, aprimorando significativamente a segurança geral do sistema. A escolha entre essas abordagens dependerá dos requisitos específicos de segurança, da tolerância à complexidade e das considerações de desempenho da aplicação de agente financeiro.

**5\. Implementando Trilhas de Auditoria Abrangentes para Acesso a Segredos**

A manutenção de trilhas de auditoria abrangentes para todo o acesso e uso de segredos por ferramentas de agentes financeiros é de importância crítica para a segurança, conformidade e resposta a incidentes. O registro detalhado das interações com segredos permite a detecção de atividades suspeitas ou não autorizadas, o cumprimento de obrigações regulatórias que exigem o rastreamento do acesso a dados e sistemas financeiros, e a facilitação da investigação de incidentes de segurança, auxiliando na identificação do escopo de qualquer potencial comprometimento.

Os gerenciadores de segredos externos oferecem capacidades de auditoria robustas. O HashiCorp Vault possui recursos de registro de auditoria que podem ser configurados para gravar todas as requisições e respostas para o servidor Vault 18. Diferentes backends de auditoria (como arquivo ou syslog) podem ser configurados, assim como o nível de detalhe a ser registrado. O AWS Secrets Manager permite o monitoramento do acesso a segredos através do AWS CloudTrail, que registra as chamadas de API feitas ao Secrets Manager, fornecendo um histórico de quem acessou quais segredos e quando 6. O Azure Key Vault oferece logs de auditoria detalhados que podem ser habilitados e revisados utilizando o Azure Monitor, registrando informações sobre todas as operações realizadas no cofre, incluindo o acesso a segredos.

Além das capacidades de auditoria dos gerenciadores de segredos, é essencial que as próprias ferramentas de agentes financeiros também mantenham logs de auditoria de suas tentativas de acesso e uso dos segredos obtidos. As informações a serem registradas devem incluir o timestamp da tentativa de acesso, a identidade da ferramenta do agente ou do usuário/processo que iniciou a ação, o segredo específico que está sendo acessado (por nome ou identificador), a ação realizada com o segredo (por exemplo, "recuperado", "usado para execução de negociação"), e o resultado da tentativa de acesso (sucesso ou falha). É de suma importância que esses logs de auditoria sejam armazenados de forma segura e à prova de adulteração, idealmente em um sistema de logging centralizado com controles de acesso apropriados. Considerar o uso de armazenamento imutável ou assinatura de logs pode prevenir modificações não autorizadas.

Finalmente, é crucial estabelecer mecanismos proativos de alerta e monitoramento com base nos logs de auditoria gerados tanto pelo gerenciador de segredos externo quanto pelas ferramentas dos agentes. Isso permite a detecção oportuna de padrões suspeitos, tentativas de acesso incomuns ou potenciais violações de segurança.

**6\. Estratégias Eficazes para Rotação de Chaves de API em Sistemas Autônomos**

A rotação regular de chaves de API e outros segredos é uma prática fundamental de segurança, especialmente para sistemas autônomos que podem operar continuamente por longos períodos. A rotação de chaves limita o tempo de vida útil de uma chave potencialmente comprometida, reduzindo a janela de oportunidade para que atores maliciosos a explorem 6. Além disso, ajuda a minimizar os danos que um atacante pode causar se uma chave for comprometida e auxilia no cumprimento de requisitos de conformidade de segurança e melhores práticas da indústria.

Os gerenciadores de segredos externos oferecem recursos para facilitar a rotação de chaves. O HashiCorp Vault possui funcionalidades embutidas para a rotação de segredos, especialmente para segredos dinâmicos, onde o Vault pode gerar automaticamente novas credenciais e revogar as antigas com base em políticas e durações de lease definidas 11. O AWS Secrets Manager permite configurar a rotação automática de segredos para diversos serviços da AWS (como bancos de dados) e oferece a possibilidade de implementar rotação personalizada para chaves de API e outros tipos de segredos utilizando funções Lambda 6. O Azure Key Vault, embora não ofereça rotação totalmente automatizada para todos os tipos de segredos, fornece a infraestrutura necessária para construir soluções de rotação utilizando Azure Functions ou outros mecanismos de automação.

Para as chaves de API utilizadas pelas ferramentas dos agentes, é crucial automatizar o processo de rotação o máximo possível para minimizar a intervenção manual e o risco de erro humano. Deve-se aproveitar os recursos de rotação do gerenciador de segredos escolhido sempre que possível. É fundamental garantir que a ferramenta do agente atualize suas chaves de API sempre que o gerenciador de segredos realizar uma rotação. Isso pode envolver a assinatura de eventos ou a consulta periódica ao gerenciador de segredos para obter a chave mais recente. O processo de rotação também deve estar alinhado com os requisitos e limitações do serviço ou plataforma financeira externa que está sendo acessada.

Implementar períodos de graça durante a rotação de chaves, onde tanto a chave antiga quanto a nova são temporariamente válidas, pode permitir que a ferramenta do agente faça a transição para a nova chave sem interrupção imediata. Outra estratégia é utilizar temporariamente chaves duplas, onde o agente pode se autenticar com a chave antiga ou a nova durante a janela de rotação. Finalmente, é essencial ter mecanismos robustos para detectar e se recuperar de falhas na rotação de chaves, incluindo o registro de tentativas de rotação, o monitoramento de erros e procedimentos de fallback para evitar que o agente perca o acesso a serviços críticos.

**7\. Conclusão: Princípios e Recomendações Chave para Gerenciamento Seguro de Segredos**

Em resumo, o gerenciamento seguro de segredos é um componente crítico para a segurança de ferramentas de agentes financeiros autônomos. As práticas inseguras, como o armazenamento de segredos diretamente no código ou em variáveis de ambiente, expõem esses sistemas a riscos significativos de comprometimento e perdas financeiras. A adoção de gerenciadores de segredos externos como HashiCorp Vault, AWS Secrets Manager ou Azure Key Vault representa uma melhoria substancial, oferecendo armazenamento centralizado, controle de acesso granular e capacidades de auditoria e rotação. Arquiteturas alternativas, como a utilização de proxies seguros ou serviços intermediários dedicados, podem minimizar ainda mais a exposição de segredos às ferramentas dos agentes. A implementação de trilhas de auditoria abrangentes e estratégias eficazes de rotação de chaves são essenciais para manter a segurança e a conformidade desses sistemas ao longo do tempo.

É fundamental adotar uma abordagem de defesa em profundidade, onde o gerenciamento seguro de segredos é uma camada crítica entre outras, incluindo segurança de rede, controles de acesso e auditorias de segurança regulares. Desenvolvedores experientes devem priorizar a implementação de práticas robustas de gerenciamento de segredos para suas ferramentas de agentes financeiros, reconhecendo os riscos significativos associados à segurança inadequada neste domínio. Tendências emergentes como módulos de segurança de hardware (HSMs), computação confidencial e avanços em arquiteturas de confiança zero podem oferecer ainda mais aprimoramentos na segurança de segredos para sistemas autônomos no futuro.

#### **Works cited**

1. Hard-Coded Secrets \- GuardRails, accessed March 26, 2025, [https://docs.guardrails.io/docs/vulnerability-classes/hard-coded-secrets](https://docs.guardrails.io/docs/vulnerability-classes/hard-coded-secrets)
2. Securing Code Secrets \- What is the relevance if the host gets compromised?, accessed March 26, 2025, [https://security.stackexchange.com/questions/217939/securing-code-secrets-what-is-the-relevance-if-the-host-gets-compromised](https://security.stackexchange.com/questions/217939/securing-code-secrets-what-is-the-relevance-if-the-host-gets-compromised)
3. The Hidden Dangers of Leaking Secrets in Code: Protecting Your Infrastructure \- KTrust, accessed March 26, 2025, [https://www.ktrust.io/post/the-hidden-dangers-of-leaking-secrets-in-code-protecting-your-infrastructure](https://www.ktrust.io/post/the-hidden-dangers-of-leaking-secrets-in-code-protecting-your-infrastructure)
4. Is it secure to store passwords as environment variables (rather than as plain text) in config files? \- Stack Overflow, accessed March 26, 2025, [https://stackoverflow.com/questions/12461484/is-it-secure-to-store-passwords-as-environment-variables-rather-than-as-plain-t](https://stackoverflow.com/questions/12461484/is-it-secure-to-store-passwords-as-environment-variables-rather-than-as-plain-t)
5. Understanding the Risks of Storing Secrets on the Frontend Storage \- Pentest Wizard, accessed March 26, 2025, [https://pentestwizard.com/the-risks-of-storing-secrets-on-the-frontend/](https://pentestwizard.com/the-risks-of-storing-secrets-on-the-frontend/)
6. Don't store secrets in code \- AWS Security Maturity Model, accessed March 26, 2025, [https://maturitymodel.security.aws.dev/en/2.-foundational/dont-store-secrets-in-code/](https://maturitymodel.security.aws.dev/en/2.-foundational/dont-store-secrets-in-code/)
7. Do not use secrets in environment variables and here's how to do it better, accessed March 26, 2025, [https://www.nodejs-security.com/blog/do-not-use-secrets-in-environment-variables-and-here-is-how-to-do-it-better](https://www.nodejs-security.com/blog/do-not-use-secrets-in-environment-variables-and-here-is-how-to-do-it-better)
8. The Pitfalls of Using Environment Variables for Config and Secrets \- CloudTruth, accessed March 26, 2025, [https://www.cloudtruth.com/blog/the-pitfalls-of-using-environment-variables-for-config-and-secrets](https://www.cloudtruth.com/blog/the-pitfalls-of-using-environment-variables-for-config-and-secrets)
9. Report secrets in environment variables to Security Command Center | Sensitive Data Protection Documentation | Google Cloud, accessed March 26, 2025, [https://cloud.google.com/sensitive-data-protection/docs/secrets-discovery](https://cloud.google.com/sensitive-data-protection/docs/secrets-discovery)
10. Storing secrets in env vars considered harmful \- Arcjet blog, accessed March 26, 2025, [https://blog.arcjet.com/storing-secrets-in-env-vars-considered-harmful/](https://blog.arcjet.com/storing-secrets-in-env-vars-considered-harmful/)
11. Secure Database Credentials with HashiCorp Vault: some Java, Node.js, and Python examples \- Medium, accessed March 26, 2025, [https://medium.com/@theflyinggibbon/secure-database-credentials-with-hashicorp-vault-some-java-node-js-and-python-examples-71507ecef1e2](https://medium.com/@theflyinggibbon/secure-database-credentials-with-hashicorp-vault-some-java-node-js-and-python-examples-71507ecef1e2)
12. Developer quick start | Vault, accessed March 26, 2025, [https://developer.hashicorp.com/vault/docs/get-started/developer-qs](https://developer.hashicorp.com/vault/docs/get-started/developer-qs)
13. Dynamic Secrets: HashiCorp Vault, PostgreSQL and Python | by Kerrache Massipssa, accessed March 26, 2025, [https://medium.com/@kerrache.massipssa/dynamic-secrets-hashicorp-vault-postgresql-and-python-40197b4a178e](https://medium.com/@kerrache.massipssa/dynamic-secrets-hashicorp-vault-postgresql-and-python-40197b4a178e)
14. HTTP API | Vault \- HashiCorp Developer, accessed March 26, 2025, [https://developer.hashicorp.com/vault/api-docs](https://developer.hashicorp.com/vault/api-docs)
15. Custom Vault Integrations: Python \- Shadow-Soft, accessed March 26, 2025, [https://shadow-soft.com/content/custom-vault-integrations-python](https://shadow-soft.com/content/custom-vault-integrations-python)
16. Storing Cassandra secrets in Hashicorp Vault | Apigee \- Google Cloud, accessed March 26, 2025, [https://cloud.google.com/apigee/docs/hybrid/v1.11/storing-cassandra-secrets-in-vault](https://cloud.google.com/apigee/docs/hybrid/v1.11/storing-cassandra-secrets-in-vault)
17. Step-by-Step Guide — Authentication, Authorization, and Identity with Hachicorp Vault Set Up On Google Cloud Platform | by Biswanath Giri, accessed March 26, 2025, [https://bgiri-gcloud.medium.com/step-by-step-guide-authentication-authorization-and-identity-with-vault-c6a946bca823](https://bgiri-gcloud.medium.com/step-by-step-guide-authentication-authorization-and-identity-with-vault-c6a946bca823)
18. tino/async-hvac: Python 3 asyncio client for HashiCorp Vault. \- GitHub, accessed March 26, 2025, [https://github.com/tino/async-hvac](https://github.com/tino/async-hvac)
19. HashiCorp Vault \- Cortex XSOAR, accessed March 26, 2025, [https://xsoar.pan.dev/docs/reference/integrations/hashi-corp-vault](https://xsoar.pan.dev/docs/reference/integrations/hashi-corp-vault)
20. hvac 2.3.0 documentation, accessed March 26, 2025, [https://python-hvac.org/en/stable/overview.html](https://python-hvac.org/en/stable/overview.html)
21. Configure Hashicorp vault with Python application | by Dikshant Rai \- Medium, accessed March 26, 2025, [https://medium.com/@dikshantdevops/configure-hashicorp-vault-with-python-application-db76a35131cf](https://medium.com/@dikshantdevops/configure-hashicorp-vault-with-python-application-db76a35131cf)
22. Client authentication with Hashicorp Vault, accessed March 26, 2025, [https://discuss.hashicorp.com/t/client-authentication-with-hashicorp-vault/29313](https://discuss.hashicorp.com/t/client-authentication-with-hashicorp-vault/29313)
23. Auth Methods — hvac 2.3.0 documentation, accessed March 26, 2025, [https://python-hvac.org/en/stable/usage/auth\_methods/index.html](https://python-hvac.org/en/stable/usage/auth_methods/index.html)
24. Top 10 Examples of hvac code in Python \- CloudDefense.AI, accessed March 26, 2025, [https://www.clouddefense.ai/code/python/example/hvac](https://www.clouddefense.ai/code/python/example/hvac)
25. hvac — hvac 2.3.0 documentation, accessed March 26, 2025, [https://python-hvac.org/](https://python-hvac.org/)
26. HashiCorp Vault Python hvac read \- Stack Overflow, accessed March 26, 2025, [https://stackoverflow.com/questions/55030523/hashicorp-vault-python-hvac-read](https://stackoverflow.com/questions/55030523/hashicorp-vault-python-hvac-read)
27. async-hvac \- piwheels, accessed March 26, 2025, [https://www.piwheels.org/project/async-hvac/](https://www.piwheels.org/project/async-hvac/)
28. async-hvac \- PyPI, accessed March 26, 2025, [https://pypi.org/project/async-hvac/](https://pypi.org/project/async-hvac/)
29. Python 3.9 · pypi packages \- Socket.dev, accessed March 26, 2025, [https://socket.dev/search?e=pypi\&q=Python+3.9\&page=2](https://socket.dev/search?e=pypi&q=Python+3.9&page=2)
30. docs: broken async-hvac sdk link · Issue \#18024 · hashicorp/vault \- GitHub, accessed March 26, 2025, [https://github.com/hashicorp/vault/issues/18024](https://github.com/hashicorp/vault/issues/18024)
31. Vault secret fetch using hvac python fails with TypeError where Type of response is
32. GetSecretValue \- AWS Secrets Manager, accessed March 26, 2025, [https://docs.aws.amazon.com/secretsmanager/latest/apireference/API\_GetSecretValue.html](https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_GetSecretValue.html)


# **Gerenciamento de Estado e Fluxo de Dados Complexos em Sistemas Multiagentes (Agency Swarm)**

## **Introdução**
